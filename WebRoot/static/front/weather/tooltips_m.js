var by=function(a){return function(c,e){var h,g;if("object"===typeof c&&"object"===typeof e&&c&&e)return h=c[a],g=e[a],h===g?0:typeof h===typeof g?h<g?-1:1:typeof h<typeof g?-1:1;throw"error";}},requestCount=0,keyvalueOld="",regNum=/^[0-9]*[0-9][0-9]A*$/,regEn=/^[A-Za-z]+$/,regCn=RegExp("[\u4e00-\u9fa5]"),requestOccur=0;function searchJudge(a){"\u8F93\u5165\u666F\u70B9\u540D\u3001\u57CE\u5E02\u540D\u3001\u5168\u62FC\u3001\u7B80\u62FC\u67E5\u8BE2"!=a?readData(a,0):hide()}
$(document).ready(function(){$("#txtZip").focus(function(){if(""==$("#txtZip").val()||"\u8F93\u5165\u666F\u70B9\u540D\u3001\u57CE\u5E02\u540D\u3001\u5168\u62FC\u3001\u7B80\u62FC\u67E5\u8BE2"==$("#txtZip").val())$(".suggest-additions").show(),hide();$(this).val()==this.defaultValue?$(this).val(""):""!=$("#txtZip").val()&&"\u8F93\u5165\u666F\u70B9\u540D\u3001\u57CE\u5E02\u540D\u3001\u5168\u62FC\u3001\u7B80\u62FC\u67E5\u8BE2"!=$("#txtZip").val()&&$("#show").show();
setInterval(function(){var a=$("#txtZip").val();""==a&&hide();a!=keyvalueOld&&($(".suggest-additions").hide(),searchJudge(a))},300)});$(document).click(function(){""==$("#txtZip").val()?($("#show").hide(),$("#txtZip").val("\u8F93\u5165\u666F\u70B9\u540D\u3001\u57CE\u5E02\u540D\u3001\u5168\u62FC\u3001\u7B80\u62FC\u67E5\u8BE2")):($("#show").hide(),$(".suggest-additions").hide())});$("#txtZip").add("#selectsionTabs").click(function(a){a.stopPropagation();return!1});$("#selectsionTabs span").click(function(){var a=
$("#selectsionTabs span").index(this);$("#selectsionGroups ul").hide();$("#selectsionGroups ul").eq(a).show();$("#selectsionTabs span").removeClass("active");$(this).addClass("active")});$("#selectsionTabs .tab").click(function(){event.stopPropagation();return!1});$("#btnZip").bind("click",function(a){a.stopPropagation();a=$("#txtZip").val();if(""==a||"\u8F93\u5165\u666F\u70B9\u540D\u3001\u57CE\u5E02\u540D\u3001\u5168\u62FC\u3001\u7B80\u62FC\u67E5\u8BE2"==$.trim(a))return window.location=
"http://m.weather.com.cn/",!1;readData(a,1)});$("#txtZip").keyup(function(a){var c=$("#txtZip");c.offset();c.height();""==$("#txtZip").val()&&(keyvalueOld="");keysearch(a)})});
function readData(a,c){keyvalueOld=a;$.ajax({type:"GET",url:"http://toy1.weather.com.cn/search?cityname="+a+"",dataType:"jsonp",requestCount:++requestCount,jsonp:"callback",jsonpCallback:"success_jsonpCallback",timeout:3E3,async:!1,success:function(e){requestCount===this.requestCount&&(0==c&&(""==e?($("#show ul").html("<span style='color:#f00;'>\u5bf9\u4e0d\u8d77\uff0c\u672a\u627e\u5230\u60a8\u67e5\u8be2\u7684\u57ce\u5e02\u5929\u6c14!</a></span>"),$("#show").show()):displayData(a,e)),1==c&&(""==e?
window.location="http://www.weather.com.cn/forecast/index.shtml":(displayData(a,e),areaid=$("#show li.select").attr("num"),regEn.test(areaid)&&(window.location="http://www.weather.com.cn/html/province/"+areaid+".shtml"),regNum.test(areaid)&&(window.location="/mweather/"+areaid+".shtml"))))},error:function(){1==c&&(window.location="/mweather/"+areaid+".shtml")}})}
function displayData(a,c){var e=[];$.each(c,function(a,b){e[a]=b.ref.split("~")});var h=e.sort(by("0")),g="",f="";regNum.test(a)&&$.each(h,function(j,b){var d=b[2]+"-"+b[9],c=RegExp(a,"ig");c.test(b[6])&&(d+="-"+b[6]);c.test(b[7])&&(d+="-"+b[7]);d=d.replace(c,"<b>"+a+"</b>");0==j&&(f+='<li class="select" num='+b[0]+">"+d+"</li>");12>j&&0<j&&(f+='<li class="unselect" num='+b[0]+">"+d+"</li>");if(11==j)return!1});regEn.test(a)&&$.each(h,function(j,b){var d=""!=b[9]?b[2]+"-"+b[9]:b[2],c=RegExp(a,"ig");
c.test(b[3])&&(d+="-"+b[3]);c.test(b[5])&&(d=b[2]+"-"+b[9]+"-"+b[5]);d=d.replace(c,"<b>"+a+"</b>");c.test(b[8])&&(d+="-<b>"+b[8].toUpperCase()+"</b>");0==j&&(f+='<li class="select" num='+b[0]+">"+d+"</li>");12>j&&0<j&&(f+='<li class="unselect" num='+b[0]+">"+d+"</li>");if(11==j)return!1});regCn.test(a)&&$.each(h,function(c,b){var d=""!=b[9]?b[2]+"-"+b[9]:b[2],e=RegExp(a,"ig"),e=RegExp(a,"ig"),d=d.replace(e,"<b>"+a+"</b>");0==c&&(f+='<li class="select" num='+b[0]+">"+d+"</li>");12>c&&0<c&&(f+='<li class="unselect" num='+
b[0]+">"+d+"</li>");if(11==c)return!1});$("#show ul").html(f);$("#show").show();$("#show li").mouseover(function(){$("#show li.select").removeClass("select").addClass("unselct");$(this).removeClass("unselect").addClass("select")}).mouseout(function(){$(this).removeClass("select").addClass("unselect")}).click(function(){var a=$("#show li.select").text(),a=a.split("-");g=$("#show li.select").attr("num");regEn.test(g)&&(window.location="http://www.weather.com.cn/html/province/"+g+".shtml");regNum.test(g)&&
(window.location="/mweather/"+g+".shtml");1<a.length&&$("#txtZip").val(a[0]);hide()})}function hide(){$("#show").hide()}
function keysearch(a){38==a.keyCode||40==a.keyCode||13==a.keyCode||27==a.keyCode||9==a.keyCode?(40==a.keyCode&&(""!=$("#show li.select").next().text()?$("#show li.select").removeClass("select").addClass("unselect").next().removeClass("unselect").addClass("select"):($("#show li.select").removeClass("select").addClass("unselect"),$("#show li:first").removeClass("unselect").addClass("select"))),38==a.keyCode&&(""!=$("#show li.select").prev().text()?$("#show li.select").removeClass("select").addClass("unselect").prev().removeClass("unselect").addClass("select"):
($("#show li.select").removeClass("select").addClass("unselect"),$("#show li:last").removeClass("unselect").addClass("select"))),13==a.keyCode&&(a=$("#show li.select").text(),a=a.split("-"),areaid=$("#show li.select").attr("num"),regEn.test(areaid)&&(window.location="http://www.weather.com.cn/html/province/"+areaid+".shtml"),regNum.test(areaid)&&(window.location="/mweather/"+areaid+".shtml"),1<a.length&&$("#txtZip").val(a[0]),hide())):0==$("#txtZip").val().length&&hide()};
